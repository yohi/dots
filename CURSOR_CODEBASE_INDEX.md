# Cursorコードベースインデックス機能 詳細ガイド

## 📋 機能概要

### 基本的な仕組み
- **埋め込み計算**: 各ファイルに対して埋め込み（embeddings）を計算
- **自動インデックス化**: プロジェクト開始時に自動的にインデックス作成
- **増分更新**: 新規ファイルを段階的にインデックスに追加
- **AI理解向上**: コードに関するAI生成回答の品質を改善

### インデックス対象
```
✅ 対象ファイル
- プロジェクト内の全ファイル
- .gitignoreに記載されていないファイル
- .cursorignoreに記載されていないファイル

❌ 除外ファイル
- .gitignore指定ファイル
- .cursorignore指定ファイル
- 大容量コンテンツファイル（推奨除外）
```

## ⚙️ 設定と構成

### インデックス状況の確認
```
Cursor Settings > Indexing & Docs
```

### 設定項目
| 項目 | 説明 | 推奨設定 |
|------|------|----------|
| 自動インデックス | 新リポジトリの自動インデックス有効化 | ON |
| ファイル除外設定 | インデックス対象外ファイルの指定 | 大容量ファイル除外 |
| インデックス進捗 | 現在の処理状況表示 | 確認必須 |

### インデックス済みファイル確認方法
```
1. Cursor Settings > Indexing & Docs
2. "View included files" をクリック
3. .txtファイルでインデックス済みファイル一覧を表示
```

## 🚀 高度な機能

### マルチルートワークスペース対応
```
特徴:
- 複数のコードベースを同時管理
- 全コードベースが自動インデックス化
- 各コードベースのコンテキストがAIで利用可能
- .cursor/rulesが全フォルダで有効
```

### PR検索機能
#### 機能詳細
- **対象**: マージ済みPRの全履歴を自動インデックス
- **検索**: セマンティック検索結果にPRサマリーを表示
- **フィルタリング**: 最新変更を優先するスマートフィルタ
- **コンテキスト取得**: `@[PR番号]`, `@[コミットハッシュ]`, `@[ブランチ名]`で取得

#### 対応プラットフォーム
| プラットフォーム | 対応状況 | 注意事項 |
|------------------|----------|----------|
| GitHub | ✅ 完全対応 | GitHubコメント・Bugbotレビュー含む |
| GitHub Enterprise | ✅ 対応 | VSCode認証制限によりgitコマンド利用 |
| Bitbucket | ✅ 対応 | - |
| GitLab | ❌ 未対応 | 現在サポート外 |

#### 使用例
```
質問例:
"他のPRでサービスはどのように実装されていますか？"

→ AIが関連PRを自動取得してコンテキストに含めて回答
```

## 🔒 セキュリティとプライバシー

### データ保存ポリシー
```
❌ サーバーに保存されないもの:
- ファイル名
- ソースコード

✅ サーバーに保存されるもの:
- 埋め込み（embeddings）のみ
- 暗号化されたコードチャンク
- 難読化されたファイル名
```

### データ検索プロセス
```
1. AIがコードベース検索実行
2. サーバーから埋め込みを取得
3. コードチャンクを復号化
4. 検索結果を返却
```

### データ保持期間
- **自動削除**: 6週間の非アクティブ期間後に削除
- **再インデックス**: プロジェクト再オープン時に自動実行
- **手動削除**: 各プロジェクトの設定から個別削除可能
- **全削除**: Cursorアカウント削除で全インデックス削除

## 📈 最適化のベストプラクティス

### パフォーマンス向上
```
✅ 推奨設定:
- 大容量ファイルを.cursorignoreで除外
- Settings > Include Project Structure を有効化
- 定期的なインデックス状況確認

❌ 避けるべき設定:
- 全ファイルの無制限インデックス
- 大容量メディアファイルのインデックス化
- 一時ファイル・ビルド成果物のインデックス化
```

### ファイル除外の推奨パターン
```gitignore
# .cursorignore 推奨設定

# ビルド成果物
dist/
build/
*.min.js
*.bundle.js

# 大容量ファイル
*.mp4
*.avi
*.mov
*.zip
*.tar.gz

# 一時ファイル
*.tmp
*.temp
*.log

# 依存関係
node_modules/
vendor/
.venv/
```

## 🛠️ トラブルシューティング

### よくある問題と解決方法

#### インデックスが作成されない
```
原因: ファイルサイズ制限・権限問題
解決策:
1. ファイルサイズ確認
2. .cursorignore設定見直し
3. プロジェクト権限確認
```

#### 検索結果が不正確
```
原因: インデックス品質・ファイル除外不適切
解決策:
1. 大容量ファイル除外
2. インデックス再作成
3. Project Structure設定有効化
```

#### マルチルートで一部が認識されない
```
原因: ワークスペース設定・権限問題
解決策:
1. 各ルートの個別確認
2. .cursor/rules設定確認
3. ワークスペース再読み込み
```

## 📊 機能評価指標

### 成功指標
- **インデックス完了率**: 95%以上
- **検索精度**: 関連ファイル検出率 90%以上
- **応答時間**: 検索結果表示 2秒以内
- **AI回答品質**: コンテキスト適合率 85%以上

### 監視項目
```
定期確認項目:
□ インデックス進捗状況
□ 除外ファイル設定適切性
□ 検索結果の関連性
□ AI回答の正確性
□ システムパフォーマンス影響
```

この詳細ガイドにより、Cursorのコードベースインデックス機能を最大限活用して、効率的な開発環境を構築できます。
