# if [ "$TERM_PROGRAM" = "vscode" ]; then
#   return
# fi


# Fig pre block. Keep at the top of this file.
[[ -f "$HOME/.fig/shell/zshrc.pre.zsh" ]] && builtin source "$HOME/.fig/shell/zshrc.pre.zsh"
# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n] confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

export LANG=ja_JP.UTF-8

# æ—¥æœ¬èªžå…¥åŠ›é–¢é€£ã®ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆIBusï¼‰
export GTK_IM_MODULE=ibus
export QT_IM_MODULE=ibus
export XMODIFIERS=@im=ibus
export INPUT_METHOD=ibus

# Waylandã§ã®æ—¥æœ¬èªžå…¥åŠ›æ”¹å–„
export IBUS_USE_PORTAL=1
export IBUS_ENABLE_SYNC_MODE=1

# Claude Code ã‚ªãƒ—ãƒˆã‚¢ã‚¦ãƒˆç’°å¢ƒå¤‰æ•°
export DISABLE_TELEMETRY=1
export DISABLE_ERROR_REPORTING=1
export DISABLE_BUG_COMMAND=1
export CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC=1

# ã‚³ãƒžãƒ³ãƒ‰ã®ã‚¹ãƒšãƒ«ãƒŸã‚¹ã‚’æŒ‡æ‘˜
setopt correct
alias la="ls -a"
alias ll="ls -l"
alias du="du -h"
alias df="df -h"
alias ld="lazydocker"
alias lg="lazygit"
alias mkdirdate="mkdir $(date +"%Y%m%d") && cd $(date +"%Y%m%d")"
alias mkdirdatetime="mkdir $(date +"%Y%m%d%I%M%S")"

# ls ã§ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è‰²ã‚’ä»˜ã‘ã‚‹
autoload -U compinit
compinit -u

# DELETE KEY æœ‰åŠ¹åŒ–
bindkey "^[[3~" delete-char
#
# HOMEBREW
export PATH=/home/${USER}/bin:${PATH}
export PATH=${PATH}:/sbin
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

#     echo '# Set PATH, MANPATH, etc., for Homebrew.' >> /home/y_ohi/.zprofile
#     echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> /home/y_ohi/.zprofile
#     eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

# export PATH="/usr/local/bin:/usr/local/sbin:$PATH"
# export PATH="/usr/local/opt/mysql@5.7/bin:$PATH"

# SSH AGENT - Disabled by default, uncomment if needed
# eval $(ssh-agent)

# # ROOTLESS DOCKER
export DOCKER_HOST=unix://$XDG_RUNTIME_DIR/docker.sock

# # DOCKER BUILDKIT
export DOCKER_BUILDKIT=1
export COMPOSE_DOCKER_CLI_BUILD=1



# dockerã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚‹ã€‚deã§å®Ÿè¡Œã§ãã‚‹ - DISABLED (peco dependency)
# alias de='docker exec -it $(docker ps | peco | cut -d " " -f 1) /bin/bash'

# ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ã‚ªãƒ¼ãƒ—ãƒ³
alias open='xdg-open .'

# ZSHå®Ÿè¡Œæ™‚ã®ã‚³ãƒ¡ãƒ³ãƒˆè¨±å¯
setopt interactivecomments

# ã‚³ãƒžãƒ³ãƒ‰å±¥æ­´ç³»
#
# å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å…ˆ
export HISTFILE=${HOME}/.zsh_history

# ãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã•ã‚Œã‚‹å±¥æ­´ã®ä»¶æ•°
export HISTSIZE=10000

# å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã•ã‚Œã‚‹å±¥æ­´ã®ä»¶æ•°
export SAVEHIST=1000000

# ã‚³ãƒžãƒ³ãƒ‰å±¥æ­´å…±æœ‰
setopt share_history

# ãƒ’ã‚¹ãƒˆãƒªã«è¿½åŠ ã•ã‚Œã‚‹ã‚³ãƒžãƒ³ãƒ‰è¡ŒãŒå¤ã„ã‚‚ã®ã¨åŒã˜ãªã‚‰å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
setopt hist_ignore_all_dups

# ã‚¹ãƒšãƒ¼ã‚¹ã§å§‹ã¾ã‚‹ã‚³ãƒžãƒ³ãƒ‰è¡Œã¯ãƒ’ã‚¹ãƒˆãƒªãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤
setopt hist_ignore_space

# ãƒ’ã‚¹ãƒˆãƒªã‚’å‘¼ã³å‡ºã—ã¦ã‹ã‚‰å®Ÿè¡Œã™ã‚‹é–“ã«ä¸€æ—¦ç·¨é›†å¯èƒ½
setopt hist_verify

# ä½™åˆ†ãªç©ºç™½ã¯è©°ã‚ã¦è¨˜éŒ²
setopt hist_reduce_blanks

# å¤ã„ã‚³ãƒžãƒ³ãƒ‰ã¨åŒã˜ã‚‚ã®ã¯ç„¡è¦–
setopt hist_save_no_dups

# historyã‚³ãƒžãƒ³ãƒ‰ã¯å±¥æ­´ã«ç™»éŒ²ã—ãªã„
setopt hist_no_store

# è£œå®Œæ™‚ã«ãƒ’ã‚¹ãƒˆãƒªã‚’è‡ªå‹•çš„ã«å±•é–‹
setopt hist_expand

# å±¥æ­´ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã«è¿½åŠ 
setopt inc_append_history

# é–‹å§‹ã¨çµ‚äº†ã‚’è¨˜éŒ²
setopt EXTENDED_HISTORY

# ðŸ”’ CursorIDE/Claude Code å±¥æ­´ç„¡åŠ¹åŒ–è¨­å®š
# CursorIDEã‚„Claude Codeã§ã®ã‚³ãƒžãƒ³ãƒ‰å±¥æ­´ã‚’ç„¡åŠ¹åŒ–ã—ã¦ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¿è­·
#
# æ¤œå‡ºæ¡ä»¶:
# - TERM_PROGRAM ãŒ cursor ã¾ãŸã¯ vscode ã‚’å«ã‚€
# - VSCODE_INJECTION ç’°å¢ƒå¤‰æ•°ãŒå­˜åœ¨
# - CURSOR_SESSION_ID ç’°å¢ƒå¤‰æ•°ãŒå­˜åœ¨
# - DISABLE_CLAUDE_CODE_HISTORY=1 ã§å¼·åˆ¶ç„¡åŠ¹åŒ–
# - ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒcursor terminalé–¢é€£
# - è¦ªãƒ—ãƒ­ã‚»ã‚¹ãŒcursor/codeã®å ´åˆ
#
# æ‰‹å‹•ã§ç„¡åŠ¹åŒ–ã—ãŸã„å ´åˆ: export DISABLE_CLAUDE_CODE_HISTORY=1
# æ‰‹å‹•ã§æœ‰åŠ¹åŒ–ã—ãŸã„å ´åˆ: unset DISABLE_CLAUDE_CODE_HISTORY (ã¾ãŸã¯ export DISABLE_CLAUDE_CODE_HISTORY="")
if [[ -n "${TERM_PROGRAM:-}" ]] && [[ "${TERM_PROGRAM}" =~ (cursor|vscode) ]] || \
   [[ -n "${VSCODE_INJECTION:-}" ]] || \
   [[ -n "${CURSOR_SESSION_ID:-}" ]] || \
   [[ -n "${DISABLE_CLAUDE_CODE_HISTORY:-}" ]] || \
   [[ "${PWD}" =~ cursor.*terminal ]] || \
   { [[ -n "${PPID:-}" ]] && { parent_process_info=$(ps -p "${PPID}" -o comm= 2>/dev/null || true); [[ -n "$parent_process_info" ]] && echo "$parent_process_info" | grep -Eqi 'cursor|code'; }; }; then

    # å±¥æ­´ã‚’ç„¡åŠ¹åŒ–
    export HISTFILE=/dev/null        # å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç„¡åŠ¹åŒ–
    export HISTSIZE=1                # ãƒ¡ãƒ¢ãƒªå†…å±¥æ­´ã‚’æœ€å°é™ã«
    export SAVEHIST=0                # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å±¥æ­´ã‚’ç„¡åŠ¹åŒ–
    setopt HIST_NO_STORE 2>/dev/null || true  # å±¥æ­´ã‚³ãƒžãƒ³ãƒ‰è‡ªä½“ã‚’ä¿å­˜ã—ãªã„

    # ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼ˆå¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆè§£é™¤ï¼‰
    # echo "ðŸ”’ IDEç’°å¢ƒæ¤œå‡º: ã‚³ãƒžãƒ³ãƒ‰å±¥æ­´ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸ (TERM_PROGRAM=${TERM_PROGRAM:-'N/A'})"
fi



# MySQL@5.7 configuration (disabled by default)
# export PATH="/home/linuxbrew/.linuxbrew/opt/mysql@5.7/bin:$PATH"
# export LDFLAGS="-L/home/linuxbrew/.linuxbrew/opt/mysql@5.7/lib"
# export CPPFLAGS="-I/home/linuxbrew/.linuxbrew/opt/mysql@5.7/include"
# export PKG_CONFIG_PATH="/home/linuxbrew/.linuxbrew/opt/mysql@5.7/lib/pkgconfig"

# peco settings - DISABLED
# # éŽåŽ»ã«å®Ÿè¡Œã—ãŸã‚³ãƒžãƒ³ãƒ‰ã‚’é¸æŠžã€‚ctrl-rã«ãƒã‚¤ãƒ³ãƒ‰
# function peco-select-history() {
#   local selected_command
#   selected_command=$(\history -n -r 1 | sed 's/[[:cntrl:]]//g' | peco --query "$LBUFFER" 2>/dev/null)
#   if [[ -n "$selected_command" ]]; then
#     BUFFER="$selected_command"
#     CURSOR=$#BUFFER
#   fi
#   zle clear-screen
# }
# zle -N peco-select-history
# bindkey '^r' peco-select-history

# search a destination from cdr list - DISABLED
# function peco-get-destination-from-cdr() {
#   cdr -l | \
#   sed -e 's/^[[:digit:]]*[[:blank:]]*//' | \
#   peco --query "$LBUFFER"
# }

# ### éŽåŽ»ã«ç§»å‹•ã—ãŸã“ã¨ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠžã€‚ctrl-uã«ãƒã‚¤ãƒ³ãƒ‰ - DISABLED
# function peco-cdr() {
#   local destination="$(peco-get-destination-from-cdr)"
#   if [ -n "$destination" ]; then
#     BUFFER="cd $destination"
#     zle accept-line
#   else
#     zle reset-prompt
#   fi
# }
# zle -N peco-cdr
# bindkey '^u' peco-cdr

###
# function ec2-ssm() {
#     local profile=$(aws configure list-profiles | peco )
#     local instance_id=$(aws --profile ${profile} ec2 describe-instances --filter "Name=instance-state-name,Values=running" "Name=dns-name,Values=" | \
#         jq -r '.Reservations[].Instances[] | .InstanceId + " " +  (.Tags[] | select(.Key=="Name").Value)' | \
#         peco | awk '{print $1}')
#     aws --profile ${profile} ssm start-session --target ${instance_id}
# }
# zle -N ec2-ssm


# ãƒ–ãƒ©ãƒ³ãƒã‚’ç°¡å˜åˆ‡ã‚Šæ›¿ãˆã€‚git checkout lbã§å®Ÿè¡Œã§ãã‚‹ - DISABLED (peco dependency)
# alias -g lb='`git branch | peco --prompt "GIT BRANCH>" | head -n 1 | sed -e "s/^\*\s*//g"`'

# export DENO_INSTALL=$HOME/.deno
# export PATH="$DENO_INSTALL/bin:$PATH"




export GOPATH=$HOME/.go
export PATH=$PATH:$GOPATH/bin

# Editor configuration (consolidated from multiple locations)
export VISUAL=nvim
export EDITOR=nvim
unset LESSEDIT

# nodenv initialization (ensure shims are prioritized in PATH)
if command -v nodenv 1>/dev/null 2>&1; then
  export PATH="$HOME/.nodenv/shims:${PATH}"
  eval "$(nodenv init -)"
fi

# direnv hook
eval "$(direnv hook zsh)"




# export PATH="/home/linuxbrew/.linuxbrew/opt/openssl@3/bin:$PATH"
#
# export PATH="/home/linuxbrew/.linuxbrew/opt/python@3.10/bin:$PATH"
# export LDFLAGS="-L/home/linuxbrew/.linuxbrew/opt/python@3.10/lib"
# export CPPFLAGS="-I/home/linuxbrew/.linuxbrew/opt/python@3.10/include"
# export PKG_CONFIG_PATH="/home/linuxbrew/.linuxbrew/opt/python@3.10/lib/pkgconfig"
alias pip='pip3'
alias python='python3'
export PATH="/home/linuxbrew/.linuxbrew/opt/python@3.11/libexec/bin:$PATH"

# function nvimvenv {
#   if [[ -e "$VIRTUAL_ENV" && -f "$VIRTUAL_ENV/bin/activate" ]]; then
#     source "$VIRTUAL_ENV/bin/activate"
#     command nvim $@
#     deactivate
#   else
#     command nvim $@
#   fi
# }
#
# alias nvim=nvimvenv

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh



### Added by Zinit's installer
if [[ ! -f $HOME/.local/share/zinit/zinit.git/zinit.zsh ]]; then
    print -P "%F{33} %F{220}Installing %F{33}ZDHARMA-CONTINUUM%F{220} Initiative Plugin Manager (%F{33}zdharma-continuum/zinit%F{220})â€¦%f"
    command mkdir -p "$HOME/.local/share/zinit" && command chmod g-rwX "$HOME/.local/share/zinit"
    command git clone https://github.com/zdharma-continuum/zinit "$HOME/.local/share/zinit/zinit.git" && \
        print -P "%F{33} %F{34}Installation successful.%f%b" || \
        print -P "%F{160} The clone has failed.%f%b"
fi

source "$HOME/.local/share/zinit/zinit.git/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit

# Load a few important annexes, without Turbo
# (this is currently required for annexes)
zinit light-mode for \
    zdharma-continuum/zinit-annex-as-monitor \
    zdharma-continuum/zinit-annex-bin-gem-node \
    zdharma-continuum/zinit-annex-patch-dl \
    zdharma-continuum/zinit-annex-rust

zinit light zdharma/fast-syntax-highlighting
# zinit light zdharma/history-search-multi-word  # Disabled due to conflict with peco
zinit light zsh-users/zsh-autosuggestions
zinit light junegunn/fzf-bin

# Load powerlevel10k theme
zinit ice depth"1"
zinit light romkatv/powerlevel10k

# æ®‹éª¸
# # Load a few important annexes, without Turbo
# # (this is currently required for annexes)
# zinit ice from"gh-r" as"program"
# zinit light-mode for \
# zinit wait lucid atload"zicompinit; zicdreplay" blockf for zsh-users/zsh-completions


### End of Zinit's installer chunk

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh


alias kgnome='killall -3 gnome-shell'

# ã‚«ã‚¹ã‚¿ãƒ é–¢æ•°ã®èª­ã¿è¾¼ã¿ï¼ˆã‚µã‚¤ãƒ¬ãƒ³ãƒˆç‰ˆ - Powerlevel10k instant promptå¯¾å¿œï¼‰
# å‹•çš„ã«dotsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¤œå‡ºï¼ˆè¤‡æ•°ã®æ–¹æ³•ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ - READMEã®å„ªå…ˆé †ä½æº–æ‹ ï¼‰
typeset DOTFILES_DIR="${DOTFILES_DIR:-}"

# Method 1: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆå„ªå…ˆåº¦æœ€é«˜ï¼‰
if [[ -r "$HOME/dots/zsh/config.zsh" ]]; then
    source "$HOME/dots/zsh/config.zsh"
    # DOTFILES_DIR ã¾ãŸã¯ãƒ¬ã‚¬ã‚·ãƒ¼ãª CUSTOM_DOTS_ROOT ã‚’ãƒã‚§ãƒƒã‚¯
    DOTFILES_DIR="${DOTFILES_DIR:-${CUSTOM_DOTS_ROOT:-}}"
    if [[ -n "$DOTFILES_DIR" ]]; then
        # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§æ˜Žç¤ºçš„ã«æŒ‡å®šã•ã‚ŒãŸå ´åˆã¯ã€ä»¥é™ã®æ¤œå‡ºã‚’ã‚¹ã‚­ãƒƒãƒ—
        [[ -d "$DOTFILES_DIR/zsh/functions" ]] && goto_load_functions=true
    fi
elif [[ -r "$HOME/.config/zsh/config.zsh" ]]; then
    source "$HOME/.config/zsh/config.zsh"
    DOTFILES_DIR="${DOTFILES_DIR:-${CUSTOM_DOTS_ROOT:-}}"
    if [[ -n "$DOTFILES_DIR" ]]; then
        # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§æ˜Žç¤ºçš„ã«æŒ‡å®šã•ã‚ŒãŸå ´åˆã¯ã€ä»¥é™ã®æ¤œå‡ºã‚’ã‚¹ã‚­ãƒƒãƒ—
        [[ -d "$DOTFILES_DIR/zsh/functions" ]] && goto_load_functions=true
    fi
fi

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§æœ‰åŠ¹ãªãƒ‘ã‚¹ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ä»¥é™ã‚’ã‚¹ã‚­ãƒƒãƒ—
if [[ "${goto_load_functions:-false}" != "true" ]]; then

    # Method 2: ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®šï¼ˆå„ªå…ˆåº¦2ç•ªç›®ã€æœªæ±ºå®šæ™‚ã®ã¿ï¼‰
    if [[ -z "$DOTFILES_DIR" ]]; then
        if [[ -n "${DOTS_ROOT_OVERRIDE:-}" ]]; then
            DOTFILES_DIR="$DOTS_ROOT_OVERRIDE"
        elif [[ -n "${DOTFILES_ROOT:-}" ]]; then
            DOTFILES_DIR="$DOTFILES_ROOT"
        fi
    fi

    # Method 3: ç¾åœ¨ã®.zshrcãƒ•ã‚¡ã‚¤ãƒ«ã®ä½ç½®ã‹ã‚‰ç›¸å¯¾ãƒ‘ã‚¹è¨ˆç®—ï¼ˆå„ªå…ˆåº¦3ç•ªç›®ã€æœªæ±ºå®šæ™‚ã®ã¿ï¼‰
    if [[ -z "$DOTFILES_DIR" ]]; then
      if [[ -n "${(%):-%N}" ]]; then
        # zshã®ãƒ‘ã‚¹ä¿®é£¾å­ã§è§£æ±ºï¼ˆå¤–éƒ¨realpathéžä¾å­˜ï¼‰
        typeset -r __zshrc_path="${(%):-%N:A}"
        DOTFILES_DIR="${__zshrc_path:h:h}"
      elif [[ -n "${BASH_SOURCE[0]}" ]]; then
        # bashäº’æ›ãƒ¢ãƒ¼ãƒ‰ï¼ˆreadlink -fãŒç„¡ã„ç’°å¢ƒã‚‚è€ƒæ…®ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
        DOTFILES_DIR="$(dirname "$(dirname "$(readlink -f "${BASH_SOURCE[0]}" 2>/dev/null || echo "${BASH_SOURCE[0]}")")")"
      fi
    fi

    # Method 4: ä¸€èˆ¬çš„ãªå ´æ‰€ã‚’é †æ¬¡ç¢ºèª
    if [[ -z "$DOTFILES_DIR" ]] || [[ ! -d "$DOTFILES_DIR/zsh/functions" ]]; then
        for candidate in \
            "$HOME/dots" \
            "$HOME/.dots" \
            "$HOME/dotfiles" \
            "$HOME/.dotfiles" \
            "$HOME/.config/dots" \
            "/home/$USER/dots"; do
            if [[ -d "$candidate/zsh/functions" ]]; then
                DOTFILES_DIR="$candidate"
                break
            fi
        done
    fi

    # Method 5: symlinkã®è¿½è·¡
    if [[ -L "$HOME/.zshrc" ]] && [[ -z "${DOTFILES_DIR:-}" ]]; then
        # .zshrcãŒsymlinkã®å ´åˆã€ãƒªãƒ³ã‚¯å…ˆã‹ã‚‰æŽ¨æ¸¬
        real_zshrc="$(readlink -f "$HOME/.zshrc" 2>/dev/null || echo "")"
        if [[ -n "$real_zshrc" ]]; then
            DOTFILES_DIR="$(dirname "$(dirname "$real_zshrc")")"
        fi
    fi

fi

# æ¤œè¨¼ã¨ãƒ‡ãƒãƒƒã‚°æƒ…å ±
typeset debug_functions=${ZSH_FUNCTIONS_DEBUG:-false}
if [[ "$debug_functions" == "true" ]]; then
    echo "ðŸ” DOTFILES_DIRæ¤œå‡º: $DOTFILES_DIR"
    echo "ðŸ” é–¢æ•°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå­˜åœ¨ç¢ºèª: $DOTFILES_DIR/zsh/functions"
fi

if [[ -d "$DOTFILES_DIR/zsh/functions" ]]; then
    # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–: globçµæžœã‚’é…åˆ—ã«æ ¼ç´ã—ã¦ã‹ã‚‰å‡¦ç†
    typeset -a func_files
    func_files=("$DOTFILES_DIR/zsh/functions"/**/*.zsh(N))

    # ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å«ã‚€å…¨ã¦ã®zshãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«èª­ã¿è¾¼ã¿
    for func_file in "${func_files[@]}"; do
        [[ ! -r "$func_file" ]] && continue

        # .broken, .disabled, .tmp ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé«˜é€ŸåŒ–ï¼‰
        case "${func_file:t}" in
            *.broken|*.disabled|*.tmp)
                [[ "$debug_functions" == "true" ]] && echo "âš ï¸  ã‚¹ã‚­ãƒƒãƒ—: ${func_file:t} (ç„¡åŠ¹åŒ–)"
                continue
                ;;
        esac

        # é–¢æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®‰å…¨ã«èª­ã¿è¾¼ã¿ï¼ˆã‚µã‚¤ãƒ¬ãƒ³ãƒˆï¼‰
        if source "$func_file" 2>/dev/null; then
            [[ "$debug_functions" == "true" ]] && echo "âœ… èª­ã¿è¾¼ã¿æˆåŠŸ: ${func_file:t}"
        else
            # ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿å‡ºåŠ›ï¼ˆinstant promptå¾Œã«è¡¨ç¤ºï¼‰
            {
                echo "âŒ zshé–¢æ•°èª­ã¿è¾¼ã¿å¤±æ•—: $func_file"
                echo "   æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ä¾å­˜é–¢ä¿‚ã®å•é¡ŒãŒã‚ã‚Šã¾ã™"
                echo "   ãƒ‡ãƒãƒƒã‚°: ZSH_FUNCTIONS_DEBUG=true ã§è©³ç´°ç¢ºèªå¯èƒ½"
            } >&2
        fi
    done
    [[ "$debug_functions" == "true" ]] && echo "âœ… é–¢æ•°èª­ã¿è¾¼ã¿å®Œäº†: $DOTFILES_DIR/zsh/functions (${#func_files[@]} files)"
else
    # é–¢æ•°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®è­¦å‘Š
    {
        echo "âš ï¸  zshé–¢æ•°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "   æ¤œå‡ºã—ãŸDOTFILES_DIR: ${DOTFILES_DIR:-'(æœªæ¤œå‡º)'}"
        echo "   æœŸå¾…ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: \$DOTFILES_DIR/zsh/functions"
        echo "   è¨­å®šæ–¹æ³•: export DOTFILES_DIR=/path/to/your/dots"
    } >&2
fi

# Add lazygit bin to PATH if available
if [[ -n "$DOTFILES_DIR" ]] && [[ -d "$DOTFILES_DIR/lazygit/bin" ]]; then
    export PATH="$DOTFILES_DIR/lazygit/bin:$PATH"
fi

# Fig post block. Keep at the bottom of this file.
[[ -f "$HOME/.fig/shell/zshrc.post.zsh" ]] && builtin source "$HOME/.fig/shell/zshrc.post.zsh"

# bun completions
[ -s "$HOME/.bun/_bun" ] && source "$HOME/.bun/_bun"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"

alias claude="$HOME/.claude/local/claude"

# opencode
export PATH="$HOME/.opencode/bin:$PATH"
