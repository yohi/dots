# è¨­å®šã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–¢é€£ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

# VIMã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-vim:
	@echo "ğŸ–¥ï¸  VIMã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	@mkdir -p $(HOME_DIR)/.vim
	@mkdir -p $(CONFIG_DIR)/nvim
	@mkdir -p $(CONFIG_DIR)/cspell
	@mkdir -p $(CONFIG_DIR)/denops_translate

	# Neovimè¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆã¨ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
	@if [ -d "$(CONFIG_DIR)/nvim" ] && [ ! -L "$(CONFIG_DIR)/nvim" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®nvimè¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(CONFIG_DIR)/nvim $(CONFIG_DIR)/nvim.backup.$$(date +%Y%m%d_%H%M%S); \
	fi
	@ln -sfn $(DOTFILES_DIR)/vim $(CONFIG_DIR)/nvim

	# å¾“æ¥ã®VIMè¨­å®šã‚‚ãƒªãƒ³ã‚¯
	@ln -sfn $(DOTFILES_DIR)/vim/rc/vimrc $(HOME_DIR)/.vimrc
	@ln -sfn $(DOTFILES_DIR)/vim/rc/gvimrc $(HOME_DIR)/.gvimrc

	# è¿½åŠ è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
	@if [ -d "$(DOTFILES_DIR)/cspell" ]; then ln -sfn $(DOTFILES_DIR)/cspell $(CONFIG_DIR)/cspell; fi
	@if [ -d "$(DOTFILES_DIR)/vim/denops_translate" ]; then ln -sfn $(DOTFILES_DIR)/vim/denops_translate $(CONFIG_DIR)/denops_translate; fi

	@echo "âœ… VIMã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"

# ZSHã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-zsh:
	@echo "ğŸš ZSHã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	@mkdir -p $(DOTFILES_DIR)/zsh

	# Zinitã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
	@if [ ! -d "$(HOME_DIR)/.local/share/zinit" ]; then \
		echo "ğŸ“¦ Zinitã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."; \
		INSTALL_SCRIPT=$$(curl --fail --show-error --silent --location https://raw.githubusercontent.com/zdharma-continuum/zinit/HEAD/scripts/install.sh); \
		if [ $$? -ne 0 ]; then \
			echo "âŒ ã‚¨ãƒ©ãƒ¼: Zinitã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ"; \
			echo "   ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„"; \
			exit 1; \
		fi; \
		bash -c "$$INSTALL_SCRIPT"; \
		if [ $$? -ne 0 ]; then \
			echo "âŒ ã‚¨ãƒ©ãƒ¼: Zinitã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ"; \
			echo "   ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"; \
			exit 1; \
		fi; \
		echo "âœ… Zinitã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸ"; \
	fi

	# æ—¢å­˜ã®zshrcè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨ã€ãªã„å ´åˆã¯åŸºæœ¬è¨­å®šã‚’ä½œæˆ
	@if [ ! -f "$(DOTFILES_DIR)/zsh/zshrc" ]; then \
		echo "# ZSH Configuration" > $(DOTFILES_DIR)/zsh/zshrc; \
		echo "# Generated by dotfiles Makefile" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "# Enable Powerlevel10k instant prompt" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'if [[ -r "$${XDG_CACHE_HOME:-$$HOME/.cache}/p10k-instant-prompt-$${(%):-%n}.zsh" ]]; then' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo '  source "$${XDG_CACHE_HOME:-$$HOME/.cache}/p10k-instant-prompt-$${(%):-%n}.zsh"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'fi' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "# Homebrew PATH" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'export PATH="/home/linuxbrew/.linuxbrew/bin:$$PATH"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "# Zinit" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'ZINIT_HOME="$${XDG_DATA_HOME:-$${HOME}/.local/share}/zinit/zinit.git"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'source "$${ZINIT_HOME}/zinit.zsh"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "# Load Powerlevel10k theme" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'zinit ice depth=1; zinit load romkatv/powerlevel10k' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "# ZSH plugins" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'zinit load zsh-users/zsh-autosuggestions' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'zinit load zsh-users/zsh-syntax-highlighting' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'zinit load zsh-users/zsh-completions' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "# Custom aliases" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'alias ll="ls -la"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'alias la="ls -A"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'alias l="ls -CF"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'alias ..="cd .."' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'alias ...="cd ../.."' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'alias grep="grep --color=auto"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'alias fgrep="fgrep --color=auto"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'alias egrep="egrep --color=auto"' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo "# Development tools" >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'export DOCKER_HOST=unix:///run/user/'$$(id -u)'/docker.sock' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'export PATH=$$HOME/bin:$$PATH' >> $(DOTFILES_DIR)/zsh/zshrc; \
		echo 'export PATH=$$PATH:/sbin' >> $(DOTFILES_DIR)/zsh/zshrc; \
	else \
		echo "âœ… æ—¢å­˜ã®zshrcè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™: $(DOTFILES_DIR)/zsh/zshrc"; \
	fi

	# P10kè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªï¼ˆæ—¢å­˜ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ï¼‰
	@if [ ! -f "$(DOTFILES_DIR)/zsh/p10k.zsh" ] && [ ! -f "$(HOME_DIR)/.p10k.zsh" ]; then \
		echo "# Powerlevel10k configuration generated by dotfiles Makefile" > $(DOTFILES_DIR)/zsh/p10k.zsh; \
		echo "# Run 'p10k configure' to customize" >> $(DOTFILES_DIR)/zsh/p10k.zsh; \
	elif [ -f "$(DOTFILES_DIR)/zsh/p10k.zsh" ]; then \
		echo "âœ… æ—¢å­˜ã®p10kè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™: $(DOTFILES_DIR)/zsh/p10k.zsh"; \
	fi

	# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
	@if [ -f "$(HOME_DIR)/.zshrc" ] && [ ! -L "$(HOME_DIR)/.zshrc" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®.zshrcã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(HOME_DIR)/.zshrc $(HOME_DIR)/.zshrc.backup.$$(date +%Y%m%d_%H%M%S); \
	fi
	@ln -sfn $(DOTFILES_DIR)/zsh/zshrc $(HOME_DIR)/.zshrc

	@if [ -f "$(DOTFILES_DIR)/zsh/p10k.zsh" ]; then \
		if [ -f "$(HOME_DIR)/.p10k.zsh" ] && [ ! -L "$(HOME_DIR)/.p10k.zsh" ]; then \
			echo "âš ï¸  æ—¢å­˜ã®.p10k.zshã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
			mv $(HOME_DIR)/.p10k.zsh $(HOME_DIR)/.p10k.zsh.backup.$$(date +%Y%m%d_%H%M%S); \
		fi; \
		ln -sfn $(DOTFILES_DIR)/zsh/p10k.zsh $(HOME_DIR)/.p10k.zsh; \
	fi

	# ZSHã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ã‚§ãƒ«ã«è¨­å®š
	@if ! grep -q "$$(which zsh)" /etc/shells; then \
		sudo sh -c "echo $$(which zsh) >> /etc/shells"; \
	fi
	@if [ "$$SHELL" != "$$(which zsh)" ]; then \
		echo "âš ï¸  ZSHã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ã‚§ãƒ«ã«è¨­å®šã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:"; \
		echo "    chsh -s $$(which zsh)"; \
	fi

	@echo "âœ… ZSHã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"

# WEZTERMã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-wezterm:
	@echo "ğŸ–¥ï¸  WEZTERMã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	@mkdir -p $(CONFIG_DIR)/wezterm

	# æ—¢å­˜è¨­å®šã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
	@if [ -f "$(CONFIG_DIR)/wezterm/wezterm.lua" ] && [ ! -L "$(CONFIG_DIR)/wezterm/wezterm.lua" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®weztermè¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(CONFIG_DIR)/wezterm/wezterm.lua $(CONFIG_DIR)/wezterm/wezterm.lua.backup.$$(date +%Y%m%d_%H%M%S); \
	fi

	# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
	@ln -sfn $(DOTFILES_DIR)/wezterm/wezterm.lua $(CONFIG_DIR)/wezterm/wezterm.lua

	@echo "âœ… WEZTERMã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"

# VS Codeã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-vscode:
	@echo "ğŸ’» VS Codeã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	@mkdir -p $(CONFIG_DIR)/Code/User

	# æ—¢å­˜è¨­å®šã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
	@if [ -f "$(CONFIG_DIR)/Code/User/settings.json" ] && [ ! -L "$(CONFIG_DIR)/Code/User/settings.json" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®VS Code settings.jsonã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(CONFIG_DIR)/Code/User/settings.json $(CONFIG_DIR)/Code/User/settings.json.backup.$$(date +%Y%m%d_%H%M%S); \
	fi
	@if [ -f "$(CONFIG_DIR)/Code/User/keybindings.json" ] && [ ! -L "$(CONFIG_DIR)/Code/User/keybindings.json" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®VS Code keybindings.jsonã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(CONFIG_DIR)/Code/User/keybindings.json $(CONFIG_DIR)/Code/User/keybindings.json.backup.$$(date +%Y%m%d_%H%M%S); \
	fi

	# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
	@ln -sfn $(DOTFILES_DIR)/vscode/settings.json $(CONFIG_DIR)/Code/User/settings.json
	@ln -sfn $(DOTFILES_DIR)/vscode/keybindings.json $(CONFIG_DIR)/Code/User/keybindings.json

	# æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
	@if command -v code >/dev/null 2>&1; then \
		echo "ğŸ“¦ VS Codeæ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."; \
		if [ -f "$(DOTFILES_DIR)/vscode/extensions.list" ]; then \
			INSTALLED_EXTENSIONS=$$(code --list-extensions); \
			while IFS= read -r extension || [ -n "$$extension" ]; do \
				if [ -n "$$extension" ] && ! echo "$$extension" | grep -q '^#' && ! echo "$$extension" | grep -q '^$$'; then \
					if echo "$$INSTALLED_EXTENSIONS" | grep -q "^$$extension$$"; then \
						echo "â­ï¸  $$extension ã¯æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã™ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰"; \
					else \
						echo "ğŸ“¦ $$extension ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."; \
						code --install-extension "$$extension" || echo "âš ï¸  $$extension ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ"; \
					fi; \
				fi; \
			done < $(DOTFILES_DIR)/vscode/extensions.list; \
		fi; \
		echo "âœ… VS Codeæ‹¡å¼µæ©Ÿèƒ½ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸ"; \
	else \
		echo "âš ï¸  VS CodeãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™"; \
	fi

	@echo "âœ… VS Codeã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"

# VS Codeç”¨ã®SuperCopilotãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-vscode-copilot:
	@echo "ğŸ§  VS Codeç”¨ã®SuperCopilotãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	@mkdir -p $(HOME_DIR)/.vscode/copilot-instructions

	# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
	@ln -sfn $(DOTFILES_DIR)/vscode/copilot-instructions/personas.md $(HOME_DIR)/.vscode/copilot-instructions/personas.md
	@ln -sfn $(DOTFILES_DIR)/vscode/copilot-instructions/commands.md $(HOME_DIR)/.vscode/copilot-instructions/commands.md
	@ln -sfn $(DOTFILES_DIR)/vscode/copilot-instructions/rules.md $(HOME_DIR)/.vscode/copilot-instructions/rules.md

	@echo "âœ… VS Codeç”¨ã®SuperCopilotãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ"
	@echo ""
	@echo "ğŸ“ VS Code settings.jsonã«ä»¥ä¸‹ã®è¨­å®šãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™:"
	@echo "\"github.copilot.chat.codeGeneration.instructions\": ["
	@echo "  {"
	@echo "    \"file\": \"~/.vscode/copilot-instructions/personas.md\""
	@echo "  },"
	@echo "  {"
	@echo "    \"file\": \"~/.vscode/copilot-instructions/commands.md\""
	@echo "  },"
	@echo "  {"
	@echo "    \"file\": \"~/.vscode/copilot-instructions/rules.md\""
	@echo "  }"
	@echo "]"
	@echo ""

# Cursorã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-cursor:
	@echo "ğŸ–±ï¸  Cursorã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	@mkdir -p $(CONFIG_DIR)/Cursor/User

	# æ—¢å­˜è¨­å®šã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
	@if [ -f "$(CONFIG_DIR)/Cursor/User/settings.json" ] && [ ! -L "$(CONFIG_DIR)/Cursor/User/settings.json" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®Cursor settings.jsonã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(CONFIG_DIR)/Cursor/User/settings.json $(CONFIG_DIR)/Cursor/User/settings.json.backup.$$(date +%Y%m%d_%H%M%S); \
	fi
	@if [ -f "$(CONFIG_DIR)/Cursor/User/keybindings.json" ] && [ ! -L "$(CONFIG_DIR)/Cursor/User/keybindings.json" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®Cursor keybindings.jsonã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(CONFIG_DIR)/Cursor/User/keybindings.json $(CONFIG_DIR)/Cursor/User/keybindings.json.backup.$$(date +%Y%m%d_%H%M%S); \
	fi

	# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
	@ln -sfn $(DOTFILES_DIR)/cursor/settings.json $(CONFIG_DIR)/Cursor/User/settings.json
	@ln -sfn $(DOTFILES_DIR)/cursor/keybindings.json $(CONFIG_DIR)/Cursor/User/keybindings.json

	@echo "âœ… Cursorã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"

# Cursor MCP Toolsã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-mcp-tools:
	@echo "ğŸ”§ Cursor MCP Toolsã®è¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	@mkdir -p $(HOME_DIR)/.cursor

	# æ—¢å­˜è¨­å®šã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
	@if [ -f "$(HOME_DIR)/.cursor/mcp.json" ] && [ ! -L "$(HOME_DIR)/.cursor/mcp.json" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®MCPè¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(HOME_DIR)/.cursor/mcp.json $(HOME_DIR)/.cursor/mcp.json.backup.$$(date +%Y%m%d_%H%M%S); \
	fi

	# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
	@ln -sfn $(DOTFILES_DIR)/cursor/mcp.json $(HOME_DIR)/.cursor/mcp.json

	# å¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
	@echo "ğŸ“¦ MCP Toolså¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..."
	@if ! command -v uvx >/dev/null 2>&1; then \
		echo "âš ï¸  uvxãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„:"; \
		echo "   pip install uv"; \
		echo "   ã¾ãŸã¯:"; \
		echo "   curl -LsSf https://astral.sh/uv/install.sh | sh"; \
	fi

	@if ! command -v npx >/dev/null 2>&1; then \
		echo "âš ï¸  npxãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚Node.jsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„"; \
	fi

	@echo "âœ… Cursor MCP Toolsã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"
	@echo "â„¹ï¸  è¨­å®šã•ã‚ŒãŸMCPã‚µãƒ¼ãƒãƒ¼:"
	@echo "  - Bitbucket MCP Server: Bitbucketã®PRç®¡ç†ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½"
	@echo "  - Playwright MCP Server: ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã®è‡ªå‹•åŒ–"
	@echo "  - AWS Documentation MCP Server: AWSæ–‡æ›¸ã®æ¤œç´¢ãƒ»å‚ç…§"
	@echo "  - Terraform MCP Server: Terraformè¨­å®šã®ç®¡ç†"
	@echo "  - ECS MCP Server: AWS ECSã®ç®¡ç†"
	@echo "â„¹ï¸  Cursorã‚’å†èµ·å‹•ã—ã¦MCPãƒ„ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚"

# Gitè¨­å®šã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-git:
	@echo "ğŸ–¥ï¸  Gitè¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."

	# æ—¢å­˜ã®Gitè¨­å®šã‚’ãƒã‚§ãƒƒã‚¯
	@CURRENT_EMAIL=$$(git config --global user.email 2>/dev/null || echo ""); \
	CURRENT_NAME=$$(git config --global user.name 2>/dev/null || echo ""); \
	if [ -n "$$CURRENT_EMAIL" ] && [ -n "$$CURRENT_NAME" ]; then \
		echo "âœ… Gitè¨­å®šã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™:"; \
		echo "   Name: $$CURRENT_NAME"; \
		echo "   Email: $$CURRENT_EMAIL"; \
	else \
		echo "ğŸ“§ Gitè¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚"; \
		if [ -n "$(GIT_USER_NAME)" ]; then \
			GIT_NAME="$(GIT_USER_NAME)"; \
		else \
			read -p "Gitã§ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: " GIT_NAME; \
		fi; \
		if [ -n "$(EMAIL)" ]; then \
			git config --global user.name "$$GIT_NAME"; \
			git config --global user.email '$(EMAIL)'; \
			echo "âœ… Gitè¨­å®šå®Œäº† - Name: $$GIT_NAME, Email: $(EMAIL)"; \
		else \
			read -p "Gitã§ä½¿ç”¨ã™ã‚‹Eãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: " EMAIL_INPUT; \
			git config --global user.name "$$GIT_NAME"; \
			git config --global user.email "$$EMAIL_INPUT"; \
			echo "âœ… Gitè¨­å®šå®Œäº† - Name: $$GIT_NAME, Email: $$EMAIL_INPUT"; \
		fi; \
	fi

	# SSHéµã®ç”Ÿæˆ
	@if [ ! -f "$(HOME_DIR)/.ssh/id_ed25519" ]; then \
		echo "ğŸ”‘ SSHéµã‚’ç”Ÿæˆä¸­..."; \
		CURRENT_EMAIL=$$(git config --global user.email 2>/dev/null || echo ""); \
		if [ -n "$(EMAIL)" ]; then \
			ssh-keygen -t ed25519 -C '$(EMAIL)' -f $(HOME_DIR)/.ssh/id_ed25519 -N ''; \
		elif [ -n "$$CURRENT_EMAIL" ]; then \
			ssh-keygen -t ed25519 -C "$$CURRENT_EMAIL" -f $(HOME_DIR)/.ssh/id_ed25519 -N ''; \
		else \
			read -p "SSHéµç”¨ã®Eãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: " SSH_EMAIL; \
			ssh-keygen -t ed25519 -C "$$SSH_EMAIL" -f $(HOME_DIR)/.ssh/id_ed25519 -N ''; \
		fi; \
		echo "âœ… SSHéµãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ: $(HOME_DIR)/.ssh/id_ed25519.pub"; \
		echo "ğŸ“‹ å…¬é–‹éµã®å†…å®¹:"; \
		cat $(HOME_DIR)/.ssh/id_ed25519.pub; \
	else \
		echo "âœ… SSHéµã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚"; \
	fi

	@echo "âœ… Gitè¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"

# Dockerè¨­å®šã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-docker:
	@echo "ğŸ³ Dockerè¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."

	# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…ˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
	@echo "ğŸ“¦ Docker rootlessç”¨ã®å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
	@sudo DEBIAN_FRONTEND=noninteractive apt-get update || true
	@sudo DEBIAN_FRONTEND=noninteractive apt-get install -y uidmap || true

	# å¿…è¦ãªã‚«ãƒ¼ãƒãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰
	@echo "ğŸ”§ å¿…è¦ãªã‚«ãƒ¼ãƒãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ä¸­..."
	@sudo modprobe nf_tables || true
	@sudo modprobe iptable_nat || true
	@sudo modprobe ip6table_nat || true

	# AppArmorã®è¨­å®šã‚’ç¢ºèªãƒ»ä¿®æ­£
	@if [ -f "$(DOTFILES_DIR)/scripts/setup-apparmor.sh" ]; then \
		if [ -x "$(DOTFILES_DIR)/scripts/setup-apparmor.sh" ]; then \
			echo "ğŸ”§ AppArmorã®è¨­å®šã‚’ç¢ºèªãƒ»ä¿®æ­£ä¸­..."; \
			$(DOTFILES_DIR)/scripts/setup-apparmor.sh; \
		else \
			echo "âŒ ã‚¨ãƒ©ãƒ¼: $(DOTFILES_DIR)/scripts/setup-apparmor.sh ã«å®Ÿè¡Œæ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“"; \
			echo "   ä¿®æ­£ã™ã‚‹ã«ã¯: chmod +x $(DOTFILES_DIR)/scripts/setup-apparmor.sh"; \
			exit 1; \
		fi; \
	else \
		echo "âŒ ã‚¨ãƒ©ãƒ¼: $(DOTFILES_DIR)/scripts/setup-apparmor.sh ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"; \
		echo "   å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ä¸­æ­¢ã—ã¾ã™"; \
		exit 1; \
	fi
	# Rootless Dockerã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
	@if ! command -v dockerd-rootless-setuptool.sh >/dev/null 2>&1; then \
		echo "ğŸ“¦ Rootless Dockerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."; \
		curl -fsSL https://get.docker.com/rootless | sh; \
	fi

	# rootless setuptoolã®å®Ÿè¡Œï¼ˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
	@echo "âš™ï¸  Rootless Dockerã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	@dockerd-rootless-setuptool.sh install --skip-iptables || \
	dockerd-rootless-setuptool.sh install || \
	echo "âš ï¸  Rootless Docker setup completed with warnings (this is often normal)"

	# ã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®š
	@echo "ğŸš€ Dockerã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®šä¸­..."
	@systemctl --user enable docker.service || true
	@systemctl --user start docker.service || true
	@sudo loginctl enable-linger $(USER) || true

	# Docker Composeã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
	@echo "ğŸ™ Docker Composeã®è¨­å®šä¸­..."
	@mkdir -p $(HOME_DIR)/.docker/cli-plugins
	@if command -v brew >/dev/null 2>&1; then \
		eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"; \
		ln -sfn $$(brew --prefix)/opt/docker-compose/bin/docker-compose $(HOME_DIR)/.docker/cli-plugins/docker-compose || true; \
	fi

	# ç’°å¢ƒå¤‰æ•°ã®è¨­å®šç¢ºèª
	@echo "ğŸ” Dockerç’°å¢ƒã®ç¢ºèªä¸­..."
	@if ! grep -q "DOCKER_HOST" $(DOTFILES_DIR)/zsh/zshrc 2>/dev/null; then \
		echo "export DOCKER_HOST=unix:///run/user/$$(id -u)/docker.sock" >> $(DOTFILES_DIR)/zsh/zshrc || true; \
	fi

	@echo "âœ… Dockerè¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"
	@echo "â„¹ï¸  ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’å†èµ·å‹•ã—ã¦ã‹ã‚‰Dockerã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚"

# è¿½åŠ ã®é–‹ç™ºç’°å¢ƒè¨­å®š
setup-development:
	@echo "âš™ï¸  è¿½åŠ ã®é–‹ç™ºç’°å¢ƒè¨­å®šã‚’å®Ÿè¡Œä¸­..."

	# Tilixã®è¨­å®š
	@if [ -f "$(DOTFILES_DIR)/tilix/tilix.dconf" ]; then \
		echo "ğŸ–¥ï¸  Tilixè¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­..."; \
		dconf load /com/gexperts/Tilix/ < $(DOTFILES_DIR)/tilix/tilix.dconf || true; \
		echo "âœ… Tilixè¨­å®šãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ"; \
	else \
		echo "âš ï¸  Tilixè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $(DOTFILES_DIR)/tilix/tilix.dconf"; \
	fi

	# logiopsã®è¨­å®šï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
	@if [ -f "$(DOTFILES_DIR)/logid/logid.cfg" ]; then \
		echo "ğŸ–±ï¸  logiopsè¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."; \
		echo "âš ï¸  æ³¨æ„: logiopsã®ä¾å­˜é–¢ä¿‚ã‚’äº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„"; \
		echo "   å¿…è¦ãªä¾å­˜é–¢ä¿‚: cmake libevdev-dev libudev-dev libconfig++-dev"; \
		echo "   ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰: sudo apt install -y cmake libevdev-dev libudev-dev libconfig++-dev"; \
		echo "   ã¾ãŸã¯ã€make setup-logiops-deps ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„"; \
		if [ ! -L "/etc/logid.cfg" ]; then \
			if [ -f "/etc/logid.cfg" ]; then \
				echo "âš ï¸  æ—¢å­˜ã®logidè¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
				sudo mv /etc/logid.cfg /etc/logid.cfg.backup.$$(date +%Y%m%d_%H%M%S) || true; \
			fi; \
		fi; \
		sudo ln -sfn $(DOTFILES_DIR)/logid/logid.cfg /etc/logid.cfg || true; \
		sudo systemctl enable logid || true; \
		echo "âœ… logiopsè¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸ"; \
		echo "â„¹ï¸  logiopsã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹å§‹ã™ã‚‹ã«ã¯: sudo systemctl start logid"; \
	else \
		echo "âš ï¸  logidè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $(DOTFILES_DIR)/logid/logid.cfg"; \
	fi

	@echo "âœ… è¿½åŠ ã®é–‹ç™ºç’°å¢ƒè¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"

# logiopsä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
setup-logiops-deps:
	@echo "ğŸ–±ï¸  logiopsä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
	@echo "ğŸ“¦ å¿…è¦ãªä¾å­˜é–¢ä¿‚: cmake libevdev-dev libudev-dev libconfig++-dev"
	@sudo DEBIAN_FRONTEND=noninteractive apt-get update || true
	@sudo DEBIAN_FRONTEND=noninteractive apt-get install -y cmake libevdev-dev libudev-dev libconfig++-dev || true
	@echo "âœ… logiopsä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸ"
	@echo "â„¹ï¸  logiopsã®è¨­å®šã‚’é©ç”¨ã™ã‚‹ã«ã¯: make setup-development"

# ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®è¨­å®š
setup-shortcuts:
	@echo "âŒ¨ï¸  ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®è¨­å®šã‚’å®Ÿè¡Œä¸­..."

	# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®š
	@if [ -f "$(DOTFILES_DIR)/gnome-shortcuts/wm-keybindings.dconf" ]; then \
		echo "ğŸªŸ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­..."; \
		dconf load /org/gnome/desktop/wm/keybindings/ < $(DOTFILES_DIR)/gnome-shortcuts/wm-keybindings.dconf || true; \
		echo "âœ… ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ"; \
	else \
		echo "â„¹ï¸  ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒãƒãƒ¼ã‚¸ãƒ£ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $(DOTFILES_DIR)/gnome-shortcuts/wm-keybindings.dconf"; \
	fi

	# ãƒ¡ãƒ‡ã‚£ã‚¢ã‚­ãƒ¼ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®š
	@if [ -f "$(DOTFILES_DIR)/gnome-shortcuts/media-keybindings.dconf" ]; then \
		echo "ğŸµ ãƒ¡ãƒ‡ã‚£ã‚¢ã‚­ãƒ¼ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­..."; \
		dconf load /org/gnome/settings-daemon/plugins/media-keys/ < $(DOTFILES_DIR)/gnome-shortcuts/media-keybindings.dconf || true; \
		echo "âœ… ãƒ¡ãƒ‡ã‚£ã‚¢ã‚­ãƒ¼ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ"; \
	else \
		echo "â„¹ï¸  ãƒ¡ãƒ‡ã‚£ã‚¢ã‚­ãƒ¼ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $(DOTFILES_DIR)/gnome-shortcuts/media-keybindings.dconf"; \
	fi

	# ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®š
	@if [ -f "$(DOTFILES_DIR)/gnome-shortcuts/custom-keybindings.dconf" ]; then \
		echo "ğŸ”§ ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­..."; \
		dconf load /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/ < $(DOTFILES_DIR)/gnome-shortcuts/custom-keybindings.dconf || true; \
		echo "âœ… ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ"; \
	else \
		echo "â„¹ï¸  ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $(DOTFILES_DIR)/gnome-shortcuts/custom-keybindings.dconf"; \
	fi

	# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šï¼ˆGNOME Terminalï¼‰
	@if [ -f "$(DOTFILES_DIR)/gnome-shortcuts/terminal-keybindings.dconf" ]; then \
		echo "ğŸ–¥ï¸  ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­..."; \
		dconf load /org/gnome/terminal/legacy/keybindings/ < $(DOTFILES_DIR)/gnome-shortcuts/terminal-keybindings.dconf || true; \
		echo "âœ… ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ"; \
	else \
		echo "â„¹ï¸  ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $(DOTFILES_DIR)/gnome-shortcuts/terminal-keybindings.dconf"; \
	fi

	@echo "âœ… ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"
	@echo "âš ï¸  è¨­å®šã‚’åæ˜ ã™ã‚‹ãŸã‚ã€ä¸€åº¦ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ»ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚"

# æ—¥æœ¬èªå…¥åŠ›ç’°å¢ƒã®è¨­å®š
setup-ime:
	@echo "ğŸˆ¹ æ—¥æœ¬èªå…¥åŠ›ç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."

	# IBusã®è¨­å®šç¢ºèª
	@if ! command -v ibus >/dev/null 2>&1; then \
		echo "âŒ IBusãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"; \
		echo "   ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰: sudo apt install -y ibus ibus-mozc"; \
		exit 1; \
	fi

	# Mozcã‚¨ãƒ³ã‚¸ãƒ³ã®ç¢ºèª
	@if ! ibus list-engine | grep -q mozc; then \
		echo "âŒ Mozcã‚¨ãƒ³ã‚¸ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"; \
		echo "   ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰: sudo apt install -y ibus-mozc"; \
		exit 1; \
	fi

	# IBusãƒ‡ãƒ¼ãƒ¢ãƒ³ã®å†èµ·å‹•
	@echo "ğŸ”„ IBusãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’å†èµ·å‹•ä¸­..."
	@pkill -f ibus-daemon || true
	@sleep 2
	@ibus-daemon -drx || true

	# è¨­å®šç¢ºèªã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹
	@echo "âœ… æ—¥æœ¬èªå…¥åŠ›ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚"
	@echo ""
	@echo "ğŸ“‹ è¿½åŠ ã§å¿…è¦ãªè¨­å®š:"
	@echo "   1. ã‚·ã‚¹ãƒ†ãƒ è¨­å®š > åœ°åŸŸã¨è¨€èª > å…¥åŠ›ã‚½ãƒ¼ã‚¹ ã§Mozcã‚’è¿½åŠ "
	@echo "   2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’å†èµ·å‹•ã—ã¦ç’°å¢ƒå¤‰æ•°ã‚’é©ç”¨"
	@echo "   3. WezTermã§Ctrl+Spaceã¾ãŸã¯Alt+åŠè§’/å…¨è§’ã§æ—¥æœ¬èªå…¥åŠ›ã‚’åˆ‡ã‚Šæ›¿ãˆ"
	@echo ""
	@echo "ğŸ”§ æ‰‹å‹•ã§æ—¥æœ¬èªå…¥åŠ›ã‚’è¨­å®šã™ã‚‹å ´åˆ:"
	@echo "   ibus-setup ã‚’å®Ÿè¡Œã—ã¦æ‰‹å‹•è¨­å®šã—ã¦ãã ã•ã„"

# ========================================
# æ–°ã—ã„éšå±¤çš„ãªå‘½åè¦å‰‡ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
# ========================================

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç³»
setup-config-vim: setup-vim
setup-config-zsh: setup-zsh
setup-config-wezterm: setup-wezterm
setup-config-vscode: setup-vscode
setup-config-vscode-copilot: setup-vscode-copilot
setup-config-cursor: setup-cursor
setup-config-mcp-tools: setup-mcp-tools
setup-config-git: setup-git
setup-config-docker: setup-docker
setup-config-development: setup-development
setup-config-shortcuts: setup-shortcuts
setup-config-ime: setup-ime
setup-config-claude: setup-claude

# ========================================
# Claude Codeè¨­å®šã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# ========================================

setup-claude: ## Claude Codeè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
	@echo "ğŸ¤– Claude Codeè¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."

	# Claudeè¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
	@mkdir -p $(HOME_DIR)/.config/claude

	# Claudeè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼
	@if [ -f "$(DOTFILES_DIR)/claude/claude-settings.json" ]; then \
		echo "ğŸ“‹ Claudeè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ä¸­..."; \
		cp "$(DOTFILES_DIR)/claude/claude-settings.json" "$(HOME_DIR)/.config/claude/claude-settings.json" && \
		echo "âœ… Claudeè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸ"; \
	else \
		echo "âš ï¸ Claudeè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $(DOTFILES_DIR)/claude/claude-settings.json"; \
	fi

	# Claude CLIã®è¨­å®šç¢ºèª
	@if command -v claude >/dev/null 2>&1; then \
		echo "âœ… Claude CLIãŒåˆ©ç”¨å¯èƒ½ã§ã™"; \
		echo "   ãƒãƒ¼ã‚¸ãƒ§ãƒ³: $$(claude --version 2>/dev/null || echo 'å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ')"; \
		echo "   è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: $(HOME_DIR)/.config/claude"; \
	else \
		echo "â„¹ï¸ Claude CLIãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“"; \
		echo "   'make install-claude-ecosystem' ã§Claude Codeé–¢é€£ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™"; \
	fi

	# CLAUDE.mdãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒ³ã‚¯ä½œæˆ
	@if [ -f "$(DOTFILES_DIR)/CLAUDE.md" ]; then \
		echo "ğŸ“– CLAUDE.mdãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒªãƒ³ã‚¯ä¸­..."; \
		ln -sf "$(DOTFILES_DIR)/CLAUDE.md" "$(HOME_DIR)/CLAUDE.md" && \
		echo "âœ… CLAUDE.mdãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒãƒªãƒ³ã‚¯ã•ã‚Œã¾ã—ãŸ: ~/CLAUDE.md"; \
	else \
		echo "âš ï¸ CLAUDE.mdãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"; \
	fi

	@echo "âœ… Claude Codeè¨­å®šã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ"
	@echo "ğŸ“š è©³ç´°ãªã‚¬ã‚¤ãƒ‰ã¯ ~/CLAUDE.md ã‚’å‚ç…§ã—ã¦ãã ã•ã„"

# ========================================
# å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹
# ========================================

# å¤ã„ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåã‚’ç¶­æŒï¼ˆæ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼‰
# setup-vim: ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿
# setup-zsh: ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿
# setup-wezterm: ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿
# ãã®ä»–ã®æ—¢å­˜ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯ãã®ã¾ã¾

# Claudeè¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup-claude:
	@echo "ğŸ¤– Claudeè¨­å®šã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	@mkdir -p $(HOME_DIR)/.claude

	# CLAUDE.mdã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ä½œæˆ
	@if [ -f "$(HOME_DIR)/.claude/CLAUDE.md" ] && [ ! -L "$(HOME_DIR)/.claude/CLAUDE.md" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®CLAUDE.mdã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(HOME_DIR)/.claude/CLAUDE.md $(HOME_DIR)/.claude/CLAUDE.md.backup.$$(date +%Y%m%d_%H%M%S); \
	fi
	@ln -sfn $(DOTFILES_DIR)/CLAUDE.md $(HOME_DIR)/.claude/CLAUDE.md

	# claude-settings.jsonã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ä½œæˆ
	@if [ -f "$(HOME_DIR)/.claude/claude-settings.json" ] && [ ! -L "$(HOME_DIR)/.claude/claude-settings.json" ]; then \
		echo "âš ï¸  æ—¢å­˜ã®claude-settings.jsonã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."; \
		mv $(HOME_DIR)/.claude/claude-settings.json $(HOME_DIR)/.claude/claude-settings.json.backup.$$(date +%Y%m%d_%H%M%S); \
	fi
	@ln -sfn $(DOTFILES_DIR)/claude-settings.json $(HOME_DIR)/.claude/claude-settings.json

	@echo "âœ… Claudeè¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚"
	@echo "   è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: ~/.claude/CLAUDE.md -> $(DOTFILES_DIR)/CLAUDE.md"
	@echo "   è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: ~/.claude/claude-settings.json -> $(DOTFILES_DIR)/claude-settings.json"

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç³»
setup-config-claude: setup-claude
