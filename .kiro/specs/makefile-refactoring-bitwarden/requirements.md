# 要件定義書

## はじめに
本仕様は、Makefileの構造的リファクタリングを行い、Bitwarden CLI連携によるセキュアな自動化フローとDevcontainer内での完全なテスト環境を構築するための要件を定義する。

## 要件

### 1. Makefile構造の再編と明確化
**目的:** メンテナとして、Makefileターゲットが整理されており、入口が明確であることを望む。これにより保守性と拡張性が向上する。

#### 受け入れ基準
1. The Makefile自動化システム shall ドメイン別のターゲット群を単一の入口から実行できる。
2. When 利用者がターゲット一覧を確認する, the Makefile自動化システム shall 公開ターゲットを網羅的に提示する。
3. The Makefile自動化システム shall ターゲット名と説明をハイフン区切りの命名規則に統一する。

### 2. 既存ターゲット互換性の維持
**目的:** 利用者として、既存の操作が壊れずに継続して使えることを望む。これにより移行コストを抑えられる。

#### 受け入れ基準
1. When 既存の公開ターゲット名が呼び出される, the Makefile自動化システム shall 後方互換の振る舞いで実行する。
2. If 旧ターゲットが統合または廃止される, the Makefile自動化システム shall 代替ターゲットへの案内を表示する。
3. The Makefile自動化システム shall 失敗時に非0の終了コードを返す。

### 3. Bitwarden CLIによるシークレット取得
**目的:** セキュリティ担当として、シークレットを安全に取得して自動化フローに提供できることを望む。これにより手動入力や漏洩リスクを減らせる。

#### 受け入れ基準
1. When Bitwarden CLIにログイン済みで対象シークレットが存在する, the Bitwarden連携フロー shall シークレットを取得して必要なコマンド実行に提供する。
2. If Bitwarden CLIが未ログインまたは利用不可, the Bitwarden連携フロー shall 明確なエラーを提示して処理を中断する。
3. If シークレットが見つからない, the Bitwarden連携フロー shall 対象名を示したエラーを返す。
4. The Bitwarden連携フロー shall シークレット値をログに出力しない。

### 4. 自動化フローの安全性と再実行性
**目的:** 管理者として、安全に再実行できる自動化フローが必要である。これにより環境の破壊や二重実行のリスクを抑える。

#### 受け入れ基準
1. The Makefile自動化システム shall 再実行時に既存設定やインストール済み資産を破壊しない。
2. While 依存関係が未満たされている, the Makefile自動化システム shall 依存関係の不足を報告して失敗する。
3. When ターゲットが既に満たされている, the Makefile自動化システム shall 再インストールを行わずに完了する。

### 5. Devcontainer内のテスト環境
**目的:** 開発者として、Devcontainer内で完全にテストできる環境が必要である。これによりホスト環境差異を排除できる。

#### 受け入れ基準
1. The Devcontainerテスト環境 shall Makefileターゲットのテストをコンテナ内で完結して実行できる。
2. When Devcontainerが起動する, the Devcontainerテスト環境 shall テストに必要な依存関係を提供する。
3. If ホスト環境の設定に依存する操作が必要, the Devcontainerテスト環境 shall 代替手順または必要条件を明示する。
