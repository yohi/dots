# 要件定義書: neovim-config-modernization

## はじめに

本仕様は、Neovim設定のモダナイゼーションを目的とする。Vim scriptからLuaへの完全移行、LSP設定の一元化、レガシーコードの削除を通じて、保守性・性能・安全性の向上を実現する。

現状ではVim scriptとLuaが混在し、LSP設定が重複・複雑化しているため、設定ロードの統一、LSP設定の集約、不要コードの整理、起動性能の最適化、セキュリティ強化を中心に要件を定義する。

## 要件

### 要件 1: Lua移行と設定ロードの統一
**目的:** 管理者として、設定がLuaに統一され、読み込み方式が明確になることで、保守と拡張を容易にしたい

#### 受け入れ基準
1. When Neovimが起動して設定をロードするとき, the Neovim設定 shall Luaモジュールのrequireによって設定を読み込む
2. If Vim scriptの設定ファイルが残存する場合, the Neovim設定 shall 起動時にそれらを読み込まない
3. The Neovim設定 shall 設定のロード順序をモジュール単位で明確にし、重複読み込みを発生させない

### 要件 2: LSP設定の一元化
**目的:** 管理者として、LSP設定を一箇所に集約し、競合や重複を無くしたい

#### 受け入れ基準
1. When LSPが初期化されるとき, the Neovim設定 shall 単一の集中設定からLSPサーバ設定を適用する
2. If 同一LSPサーバに対する複数の設定が存在する場合, the Neovim設定 shall 重複設定を無効化し、集中設定のみを有効にする
3. The Neovim設定 shall LSP共通設定（診断、補完能力、キーマップなど）を一元管理する
4. When 新しいLSPサーバを追加する場合, the Neovim設定 shall 単一の場所への追加だけで有効化できる

### 要件 3: レガシーコードと不要設定の整理
**目的:** 管理者として、不要な設定や古いコードを削除し、設定全体を簡潔に保ちたい

#### 受け入れ基準
1. The Neovim設定 shall 起動時に参照されない設定ファイルやモジュールを含まない
2. The Neovim設定 shall コメントアウトされた旧設定や未使用のキーマップを保持しない
3. The Neovim設定 shall TODOマーカーを含まない
4. When 機能が削除されるとき, the Neovim設定 shall 関連する設定・プラグイン定義・キーマップを同時に削除する

### 要件 4: 起動性能と更新動作の最適化
**目的:** 利用者として、起動が速く、不要な処理が走らない設定にしたい

#### 受け入れ基準
1. When Neovimが起動するとき, the Neovim設定 shall 起動時に必須でないプラグインを遅延ロードする
2. The Neovim設定 shall updatetimeを明示的に設定する
3. The Neovim設定 shall 起動時に自動のプラグイン更新チェックを実行しない

### 要件 5: セキュリティと外部ソース管理
**目的:** 管理者として、APIキー管理と外部ソース実行のリスクを最小化したい

#### 受け入れ基準
1. Where AIプラグインが有効な場合, the Neovim設定 shall APIキーを環境変数または外部の安全なストアから取得する
2. If 必要なAPIキーが未設定の場合, the Neovim設定 shall 該当プラグインを無効化し、明確な警告を表示する
3. The Neovim設定 shall 起動時に外部ソースの直接実行をデフォルトで無効にする
4. When 外部ソースの実行を有効にする場合, the Neovim設定 shall 明示的なオプトイン設定が存在する場合にのみ有効化する
