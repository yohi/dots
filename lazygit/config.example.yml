# LazyGit Configuration Example for AI Commit Message Generator
# Copy this to ~/.config/lazygit/config.yml or merge with your existing config

customCommands:
  # ============================================================================
  # AI-Powered Commit Message Generator
  # ============================================================================
  # This command integrates AI-generated commit messages directly into LazyGit
  # Press Ctrl+A in the files view to generate commit message suggestions
  #
  # Requirements: 1.1, 1.2, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 5.1, 5.2, 5.3, 5.4
  #               7.1, 7.2, 7.3, 8.2, 8.4
  # ============================================================================
  
  - key: "<c-a>"
    description: "AI Commit: Generate commit messages with AI"
    context: "files"
    loadingText: "Generating commit messages with AI..."
    
    prompts:
      - type: "menuFromCommand"
        title: "Select a commit message"
        
        # Main command pipeline
        command: |
          set -o pipefail  # Requirement 8.2: Catch pipeline failures
          
          # ========================================================================
          # AI Backend Configuration
          # ========================================================================
          # Requirement 7.1, 7.3: Configure AI backend via environment variable
          # 
          # Available backends:
          #   - gemini: Google Gemini (fast, free tier available)
          #   - claude: Anthropic Claude (high quality, paid)
          #   - ollama: Local LLM (private, free, requires setup)
          #   - mock: Testing backend (no API key needed)
          #
          # Set in your shell profile (~/.bashrc or ~/.zshrc):
          #   export AI_BACKEND="gemini"
          #
          # Or uncomment one of the lines below to set it here:
          # ========================================================================
          
          # export AI_BACKEND="gemini"   # Recommended for most users
          # export AI_BACKEND="claude"   # Best quality
          # export AI_BACKEND="ollama"   # Privacy-focused
          export AI_BACKEND="${AI_BACKEND:-mock}"  # Default: mock for testing
          
          # ========================================================================
          # API Key Configuration
          # ========================================================================
          # Requirement 7.1: API key management via environment variables
          #
          # IMPORTANT: Set these in your shell profile, NOT here!
          # Add to ~/.bashrc or ~/.zshrc:
          #
          # For Gemini:
          #   export GEMINI_API_KEY="your-api-key-here"
          #   Get key from: https://aistudio.google.com/app/apikey
          #
          # For Claude:
          #   export ANTHROPIC_API_KEY="your-api-key-here"
          #   Get key from: https://console.anthropic.com/
          #
          # For Ollama:
          #   No API key needed! Just install and run: ollama serve
          # ========================================================================
          
          # ========================================================================
          # Optional Configuration
          # ========================================================================
          # Customize these settings based on your preferences
          # ========================================================================
          
          # Timeout for AI requests (in seconds)
          # - Cloud AI (Gemini/Claude): 30 seconds is usually enough
          # - Local AI (Ollama): May need 60-120 seconds depending on model
          export TIMEOUT_SECONDS="${TIMEOUT_SECONDS:-30}"
          
          # Gemini model selection
          # Options: gemini-1.5-flash (fast), gemini-1.5-pro (quality)
          export GEMINI_MODEL="${GEMINI_MODEL:-gemini-1.5-flash}"
          
          # Claude model selection
          # Options: claude-3-5-haiku-20241022 (fast), claude-3-5-sonnet-20241022 (quality)
          export CLAUDE_MODEL="${CLAUDE_MODEL:-claude-3-5-haiku-20241022}"
          
          # Ollama model selection
          # Options: mistral (balanced), codellama (code-focused), mixtral (quality)
          export OLLAMA_MODEL="${OLLAMA_MODEL:-mistral}"
          
          # Ollama server host (if running on different machine/port)
          export OLLAMA_HOST="${OLLAMA_HOST:-http://localhost:11434}"
          
          # ========================================================================
          # Pre-flight Check
          # ========================================================================
          # Requirement 2.4: Prevent execution when no changes are staged
          # ========================================================================
          
          if git diff --cached --quiet; then
            echo "Error: No staged changes. Please stage files first."
            exit 1
          fi
          
          # ========================================================================
          # Main Pipeline
          # ========================================================================
          # Requirement 7.2: Execute configured command with diff as input
          # Requirement 8.2, 8.4: Enhanced error handling with pipefail and timeout
          #
          # Pipeline stages:
          # 1. Get staged diff (git diff --cached)
          # 2. Limit size to 12KB (head -c 12000) - prevents token limit issues
          # 3. Generate messages (ai-commit-generator.sh) - calls AI backend
          # 4. Parse output (parse-ai-output.sh) - extracts individual messages
          #
          # NOTE: Update these paths to point to where you installed the scripts!
          # Example: /home/username/lazygit-ai-commit/ai-commit-generator.sh
          # ========================================================================
          
          git diff --cached | head -c 12000 | scripts/lazygit-ai-commit/ai-commit-generator.sh | scripts/lazygit-ai-commit/parse-ai-output.sh
        
        # ========================================================================
        # Output Parsing Configuration
        # ========================================================================
        # Requirement 5.4: Parse AI output with regex
        # This regex extracts non-empty lines as menu items
        # ========================================================================
        
        filter: "^(?P<msg>.+\\S.*)$"
        valueFormat: "{{ .msg }}"
        labelFormat: "{{ .msg | green }}"
    
    # ========================================================================
    # Commit Execution
    # ========================================================================
    # Requirement 4.1, 4.2, 4.3: Execute commit with selected message
    # The | quote filter ensures proper shell escaping (Requirement 4.2, 8.3)
    # ========================================================================
    
    command: 'git commit -m {{.Form.SelectedMsg | quote}}'

# ============================================================================
# Additional Custom Commands (Optional)
# ============================================================================
# You can add more custom commands here for other workflows
# ============================================================================

# Example: Quick commit with current timestamp
#  - key: "<c-t>"
#    description: "Quick commit with timestamp"
#    context: "files"
#    command: 'git commit -m "WIP: $(date +%Y-%m-%d\ %H:%M:%S)"'

# Example: Amend last commit
#  - key: "<c-e>"
#    description: "Amend last commit"
#    context: "files"
#    command: 'git commit --amend --no-edit'
