# Security CodeRabbit Audit - セキュリティ監査

CodeRabbit CLIを活用した包括的セキュリティ監査を実行します。OWASP Top 10に準拠し、エンタープライズレベルのセキュリティ基準で評価します。

## 目標
コードベース全体のセキュリティ脆弱性を特定し、即座に実装可能な修正案と長期的なセキュリティ強化戦略を提供する。

## セキュリティ監査戦略

### フェーズ1: セキュリティ特化スキャン
[CodeRabbit CLI公式ドキュメント](https://docs.coderabbit.ai/cli/overview)に基づき、以下のコマンドを実行：

```bash
# セキュリティ特化レビュー（AI統合最適化）
coderabbit --prompt-only

# 詳細セキュリティ分析（平文出力）
coderabbit --plain --type all

# 未コミット変更のセキュリティチェック
coderabbit --type uncommitted --prompt-only

# 特定ベースブランチとのセキュリティ差分
coderabbit --base main --prompt-only
```

### フェーズ2: 脅威モデリング分析
コードベースを以下の観点で分析：
- **機密データフロー**: 個人情報、認証情報の取り扱い
- **攻撃表面**: 外部入力、APIエンドポイント
- **権限エスカレーション**: アクセス制御の抜け穴
- **暗号化実装**: 暗号アルゴリズム、鍵管理

### フェーズ3: コンプライアンス確認
- GDPR準拠性（データ処理・削除）
- SOC 2 Type II要件
- PCI DSS（決済処理関連）
- セキュアコーディング標準準拠

## セキュリティレポート仕様

### 脅威レベル分類
```text
🔴 CRITICAL (CVSS 9.0-10.0)
- SQLインジェクション
- リモートコード実行
- 認証バイパス
- 機密データ漏洩

🟠 HIGH (CVSS 7.0-8.9)
- XSS攻撃
- CSRF脆弱性
- 権限昇格
- 暗号化不備

🟡 MEDIUM (CVSS 4.0-6.9)
- 情報漏洩
- セッション管理不備
- 入力検証不足
- ログ出力問題

🟢 LOW (CVSS 0.1-3.9)
- 設定ミス
- コメント内機密情報
- 弱い暗号化
- セキュリティヘッダー不足
```

### エグゼクティブサマリー
```text
🛡️ セキュリティ監査レポート
実行日時: {timestamp}
監査範囲: {scope_description}

脅威スコア: {threat_score}/100
コンプライアンス: {compliance_score}/100

発見された脆弱性:
🔴 Critical: {critical_count}
🟠 High: {high_count}
🟡 Medium: {medium_count}
🟢 Low: {low_count}

推奨対応期限:
- Critical: 即座（24時間以内）
- High: 緊急（1週間以内）
- Medium: 重要（1ヶ月以内）
- Low: 計画的（3ヶ月以内）
```

### 修正優先度マトリクス
各脆弱性に対して以下を提供：
- **CVSS評価**: 具体的なスコアと根拠
- **攻撃シナリオ**: 悪用される可能性
- **ビジネス影響**: データ漏洩、サービス停止等
- **修正コード**: 即座に実装可能なサンプル
- **検証方法**: 修正後のテスト手順

## アクションプラン生成

### 即時対応（24時間以内）
```text
1. Critical脆弱性の緊急パッチ適用
2. 攻撃表面の一時的縮小
3. 監視・検知の強化
4. インシデント対応チーム待機
```

### 短期対応（1週間以内）
```text
1. High脆弱性の本格修正
2. セキュリティテスト強化
3. アクセス制御見直し
4. ログ監視体制確立
```

### 中長期対応（1-3ヶ月）
```text
1. セキュリティアーキテクチャ改善
2. 開発プロセス強化
3. 自動化ツール導入
4. 定期監査体制構築
```

## 実行要件

### 技術的制御
- CodeRabbit CLIの`--prompt-only`モードでAI統合
- `--plain`モードで詳細分析
- セキュリティフォーカスの出力フォーマット

### 出力フォーマット
- JSON（ツール連携用）
- Markdown（開発者用）
- PDF（経営報告用）

## 成功基準
- OWASP Top 10の包括的チェック完了
- 脆弱性の定量的評価とCVSSスコア算出
- 即座に実装可能な修正案の提供
- 組織のセキュリティ向上に直結する実用的な結果
